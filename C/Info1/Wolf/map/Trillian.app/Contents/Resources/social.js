var a="Trillian Social Panels | Copyright (C) 2012 Cerulean Studios, LLC | Last Update 2012-02-15 16:13:00 andy magoon";function newsItemMenu(d,b,c){trillian.newsItemMenu(d,b,c)}function newsGroupMenu(c,b,d){trillian.newsGroupMenu(c,b,d)}function newsAccountMenu(b,c){trillian.newsAccountMenu(b,c)}function newsItemDestroy(b){trillian.newsItemDestroy(b)}function newsGroupViewed(b){trillian.newsGroupViewed(b)}function newsItemDefaultAction(b){trillian.newsItemDefaultAction(b)}function newsPost(b,c){trillian.newsPost(b,c)}function newsGetImageFromFile(){trillian.newsGetImageFromFile()}function newsGetImageFromClipboard(){if(g_pastetarget){for(l_itemEnum in g_myPanel.itemList){if(g_myPanel.itemList[l_itemEnum].id==g_pastetarget){if(g_myPanel.itemList[l_itemEnum].images_allowed){trillian.newsGetImageFromClipboard()}}}}else{if(g_myPanel.DOMElementList[g_myPanel.groupSelectedID].images_allowed){trillian.newsGetImageFromClipboard()}}}function newsComment(d,c,b){trillian.newsComment(d,c,b)}function newsImageDefaultAction(c,b){trillian.newsImageDefaultAction(c,b)}var g_lastUnread=-1;function newsAccountUnread(b){if(b!=g_lastUnread){trillian.newsAccountUnread(b);g_lastUnread=b}}function newsPutImage(b){if(g_pastetarget){var g=$("div.item[item="+g_pastetarget+"]").find(".richtext:first").contents()[0].documentElement;$("div.item[item="+g_pastetarget+"]").find(".richtext:first")[0].contentWindow.document.execCommand("insertimage",false,"data:image/png;base64,"+b);$(g).find("img").css("max-height","32").css("max-width","64");var e="";var j=g_myPanel.DOMElementList[$("div.item[item="+g_pastetarget+"]").attr("id")].comment_limit;for(var i="";i.length<g_myPanel.DOMElementList[g_myPanel.groupSelectedID].shortened_url_length;i+="X"){}var c=g.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,i).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,i).length;var c=g.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,i).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,i).length;if(j>c){e=j-c+" left"}else{e=c-j+" over"}$("div.item[item="+g_pastetarget+"]").find(".richtext:first").show().end().find(".controls").show().find(".submit input").val(g_myPanel.DOMElementList[$("div.item[item="+g_pastetarget+"]").attr("id")].comment_button.replace("%edit.count_relative%",e))}else{$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("insertimage",false,"data:image/png;base64,"+b);var g=$("#post").find(".richtext:first").contents()[0].documentElement;$(g).find("img").css("max-height","32").css("max-width","64");var h=$(".post > .controls > .submit");var d=h.find("input");var j=$(h).data("limit");var f=$(h).data("text");for(var i="";i.length<g_myPanel.DOMElementList[g_myPanel.groupSelectedID].shortened_url_length;i+="X"){}if(j>g.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/ig,i).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,i).length){var e=j-g.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,i).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,i).length+" left"}else{var e=g.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,i).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,i).length-j+" over"}$(d).val(f.replace("%edit.count_relative%",e))}}function newsPanel(){}newsPanel.prototype={constructor:newsPanel,accountList:[],groupList:[],itemList:[],updateScheduled:null,updating:false,DOMElementList:[],DOMElementNextID:1,groupSelectedID:-1,itemSelected:-1,contacts:new Object(),dirty:false,setDirty:function(b){b.dirty=true;this.dirty=true;return},addAccount:function(b){b.DOMElementID=this.DOMElementNextID++;this.DOMElementList[b.DOMElementID]=b;this.accountList.push(b);this.setDirty(b);this.scheduleUpdate();return},addGroup:function(b){var c;for(c=0;c<this.groupList.length;c++){if(this.groupList[c].name==b.name&&this.groupList[c].header==b.header){return}}b.DOMElementID=this.DOMElementNextID++;this.DOMElementList[b.DOMElementID]=b;this.groupList.push(b);this.setDirty(b);this.scheduleUpdate();return},addItem:function(b){if(b.item){if(this.contacts[b.display_name]){this.contacts[b.display_name]++}else{this.contacts[b.display_name]=1}}b.DOMElementID=this.DOMElementNextID++;this.DOMElementList[b.DOMElementID]=b;this.itemList.push(b);this.setDirty(b);for(l_group in b.groups){for(l_enum=0;l_enum<this.groupList.length;l_enum++){if(this.groupList[l_enum].name==b.groups[l_group]){if(b.longitude){this.groupList[l_enum].hasmap=true}if(this.groupList[l_enum].unread<100){if(b.unread){this.groupList[l_enum].unread++}}}}}this.scheduleUpdate();return},addImage:function(c,b){for(l_itemEnum in this.itemList){if(this.itemList[l_itemEnum].id==c){this.itemList[l_itemEnum].image_url=b;this.setDirty(this.itemList[l_itemEnum]);this.scheduleUpdate();return true}}},removeGroup:function(b,c){var e;for(e=0;e<this.groupList.length;e++){if(this.groupList[e].name==c&&this.groupList[e].header==b){var d=this.groupList[e].DOMElementID;$("#"+d).remove();if($("li.header[header="+this.groupList[e].header+"]").find("li.group").length==0){$("li.header[header="+this.groupList[e].header+"]").remove()}this.groupList.splice(e,1);delete this.DOMElementList[d];break}}this.scheduleUpdate();return},tock:function(){var c=new Date().getTime();for(l_itemEnum in this.itemList){if(this.DOMElementList[this.groupSelectedID]){if(this.itemList[l_itemEnum].groups.indexOf(this.DOMElementList[this.groupSelectedID].name)!=-1){var d=$("#"+this.itemList[l_itemEnum].DOMElementID+"");if(d){var b=d.find(".time:first");if(b.length){if(this.itemList[l_itemEnum].timestamp>31337){b.html(relativeTime(this.itemList[l_itemEnum].timestamp,c))}else{b.html("")}}}}}}if(this.dirty){this.scheduleUpdate()}resize()},update:function(k){if(this.updating&&!k){return this.scheduleUpdate()}if(g_editing&&!k){return this.scheduleUpdate(5000)}if(g_replying&&!k){return this.scheduleUpdate(5000)}g_replying=false;this.updating=true;if(this.updateScheduled){this.updateScheduled=clearTimeout(this.updateScheduled)}this.itemList.sort(function(m,l){if(m.timestamp<l.timestamp){return 1}if(m.timestamp>l.timestamp){return -1}if(m.id<l.id){return 1}if(m.id>l.id){return 1}return 0});$("#items > .empty").remove();if(this.dirty){this.dirty=false;var f=$("#accounts");for(l_dirtyEnum in this.accountList){if(this.accountList[l_dirtyEnum].dirty){this.accountList[l_dirtyEnum].dirty=false;f.append(this.accountList[l_dirtyEnum].getHTML())}}f=null;for(l_dirtyEnum in this.groupList){if(this.groupList[l_dirtyEnum].dirty){this.groupList[l_dirtyEnum].dirty=false;if($("#groups > .header > li.group[group="+escape(this.groupList[l_dirtyEnum].name)+"]").length){$("#groups > .header > li.group[group="+escape(this.groupList[l_dirtyEnum].name)+"]").remove()}if($("li[header="+this.groupList[l_dirtyEnum].header+"]").length<1){var h=$("<li></li>").addClass("header").attr("header",this.groupList[l_dirtyEnum].header).appendTo("#groups");$("<div></div>").addClass("label").html(this.groupList[l_dirtyEnum].header).appendTo(h);$("<div></div>").addClass("showhide").append($("<div></div>").addClass("label").text("Hide").hide()).appendTo(h)}f=$("li[header="+this.groupList[l_dirtyEnum].header+"]");if(this.groupList[l_dirtyEnum].dfault&&this.groupSelectedID==-1){this.groupSelectedID=this.groupList[l_dirtyEnum].DOMElementID}f.append(this.groupList[l_dirtyEnum].getHTML())}}for(l_dirtyEnum in this.itemList){if(this.itemList[l_dirtyEnum].parent_id){continue}if(this.itemList[l_dirtyEnum].dirty){this.itemList[l_dirtyEnum].dirty=false;if(this.groupSelectedID!=-1){if(this.itemList[l_dirtyEnum].groups.indexOf(this.DOMElementList[this.groupSelectedID].name)!=-1){var b=$("#items").find("#"+this.itemList[l_dirtyEnum].DOMElementID);if(b.length){$("div.item[item="+this.itemList[l_dirtyEnum].id+"]").replaceWith(this.itemList[l_dirtyEnum].getItemHTML())}else{$("#items").append(this.itemList[l_dirtyEnum].getItemHTML())}b=null}}}}for(l_dirtyEnum in this.itemList){if(!this.itemList[l_dirtyEnum].parent_id){continue}if(this.itemList[l_dirtyEnum].dirty){this.itemList[l_dirtyEnum].dirty=false;if(this.groupSelectedID!=-1){if(this.itemList[l_dirtyEnum].groups.indexOf(this.DOMElementList[this.groupSelectedID].name)!=-1){var b=$("#items").find("#"+this.itemList[l_dirtyEnum].DOMElementID);if(b.length){$("div.subitem[item="+this.itemList[l_dirtyEnum].id+"]").replaceWith(this.itemList[l_dirtyEnum].getCommentHTML())}else{var g=$("div.item[item="+this.itemList[l_dirtyEnum].parent_id+"]");if(g.length){var c=g.find("div.subitems:first");if(!c.length){c=this.DOMElementList[g.attr("id")].getSubitemsHTML();c.appendTo(g)}f=c.show().find(".comments");if(f.children().length){var e=$("<div></div>").addClass("separator");e.appendTo(f);e=null}if(c.find(".reply").length&&!(c.find(".reply").find(".separator").length)){var i=$("<div></div>").addClass("separator").css("margin-left","-4px");i.prependTo(c.find(".reply"));i=null}var d=this.itemList[l_dirtyEnum].getCommentHTML();d.appendTo(f);var j=c.find(".reply");if(j.length&&g_myPanel.accountList[0].medium=="TWITTER"){j.richReply()}j=null;d=null;c=null;f=null}}}}}}f=null}if(this.groupSelectedID!=$("#groups > .header > li[group].selected").attr("id")&&this.DOMElementList[this.groupSelectedID]){$("#groups > .header > li[group].selected").removeClass("selected");$("#"+this.DOMElementList[this.groupSelectedID].DOMElementID).addClass("selected");$("#items").children().remove();setTimeout(function(){g_myPanel.drawGroup()},10);return this.updating=false}$("#groups > .header > li.group").each(function(){var n=$(this).find(".unread");var m=g_myPanel.DOMElementList[$(this).attr("id")];if($(this).hasClass("selected")){m.unread=0}var l=m.unread;n.find(".count").text(l);if(l>0){n.show();$(this).find(".label").addClass("limited")}else{n.hide();$(this).find(".label").removeClass("limited")}n=null;m=null;l=null});$("div.reply").find(".richtext").each(function(){if($(this)[0].contentWindow.document.designMode=="on"){$(this).addClass("restore_design_mode");$(this).data("restore",$(this).contents()[0].documentElement.innerHTML);$(this)[0].contentWindow.document.designMode="off"}});$("div.item[item]").tsort({attr:"timestamp",order:"desc"});$("div.item[item]").each(function(){$(this).find("div.subitem[item]").sortElements(function(m,l){return $(m).attr("timestamp")<$(l).attr("timestamp")?-1:1})});$(".restore_design_mode").each(function(){$(this).parent().parent().parent().richReply();if($(this).data("restore")){$(this).data("restore",null)}});for(;$("div.item[item]").length>100;){newsItemDestroy($("div.item[item]:last").attr("item"));$("div.item[item]:last").remove()}if(!$("#items").children().length){if(this.DOMElementList[this.groupSelectedID]&&!this.DOMElementList[this.groupSelectedID].stats){$("<div></div>").addClass("empty").append($("<p></p>").html(this.DOMElementList[this.groupSelectedID].empty_string)).appendTo($("#items"))}}this.updating=false;resize();unread()},drawGroup:function(){this.dirty=false;if(this.DOMElementList[this.groupSelectedID].hasmap){var j=$("<iframe></iframe").attr("id","map").attr("name","map").attr("src","social-location.html").load(function(){window.frames.map.initialize()});$("#view").append(j);$("#view").show()}else{$("#view").html("");$("#view").hide()}var c=100;var e=-1;var h=$("#items");for(l_itemEnum in this.itemList){if(this.itemList[l_itemEnum].groups.indexOf(this.DOMElementList[this.groupSelectedID].name)!=-1){if(this.itemList[l_itemEnum].parent_id<1){if(c--<1){if(e==-1){e=l_itemEnum}break}h.append(this.itemList[l_itemEnum].getItemHTML())}}}for(l_itemEnum in this.itemList){var l=this.itemList[l_itemEnum];if(l.groups.indexOf(this.DOMElementList[this.groupSelectedID].name)!=-1){if(l.parent_id>0){var i=$("div.item[item="+l.parent_id+"]");if(i.length){var b=i.find(".subitems:first");if(!b.length){b=g_myPanel.DOMElementList[i.attr("id")].getSubitemsHTML();b.appendTo(i)}h=b.show().find(".comments");if(h.children().length){var g=$("<div></div>").addClass("separator");g.appendTo(h);g=null}if(b.find(".reply").length&&!(b.find(".reply").find(".separator").length)){var k=$("<div></div>").addClass("separator").css("margin-left","-4px");k.prependTo(b.find(".reply"));k=null}var f=l.getCommentHTML();f.appendTo(h);var m=b.find(".reply");if(m.length&&g_myPanel.accountList[0].medium=="TWITTER"){m.richReply()}f=null;m=null;b=null;h=null}i=null}}l=null}$("#post").html("");$("#post").append(this.DOMElementList[this.groupSelectedID].getPostHTML());var d=$("#post").find(".richtext:first");if(d.length){d[0].contentWindow.document.designMode="on";$(d.contents()[0].documentElement).attr("spellcheck","false");$(d.contents()[0].documentElement).html($("#post").find(".richtext:first").data("helper"));$(d.contents()[0].documentElement).css("font-size","14px").css("font-family","Helvetica").css("color","#acacac");if($.browser.version>"534.48."){$(d.contents()[0].documentElement).css("margin-top","-7px")}d[0].contentWindow.document.onpaste=function(o){o.preventDefault();if(o.clipboardData.types){if(o.clipboardData.types.length){if(o.clipboardData.types[1]=="text/plain"||o.clipboardData.types[0]=="text/rtf"){var n=o.clipboardData.getData("text/plain")}}}if(n){n=decodeURIComponent(encodeURIComponent(n.stripHtml()).replace(/%0D%0A/g,"").replace(/%0D/g,""));$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("inserttext",false,n);$($("#post").find(".richtext:first").contents()[0].documentElement).keyup()}else{newsGetImageFromClipboard()}return false};$(d.contents()[0].documentElement).keydown(function(p){if(p.which==9||p.which==39||p.which==13||p.which==32){var o=$(".post > .autocomplete").find(".hover");if(o.length){o.click();return false}}if(p.which==9){if($(".post > .autocomplete").length){}$(".post > .autocomplete").find(".entry:first").click();return false}else{if(p.which==40){var o=$(".post > .autocomplete").find(".hover");if(o.length){if(o.next().length){for(var n=0;n<1||((p.metaKey||p.ctrlKey)&&n<5);n++){if(n>1){var o=$(".post > .autocomplete").find(".hover")}o.next().addClass("hover").siblings().removeClass("hover");if($(".post > .autocomplete").height()-$(".hover:first").position().top<o.height()){$(".post > .autocomplete").scrollTop($(".hover:first").height()+8+$(".post > .autocomplete").scrollTop())}}}return false}else{if($(".post > .autocomplete").length){$(".post > .autocomplete").data("entered","true").find(".entry:first").addClass("hover");return false}}}else{if(p.which==38){var o=$(".post > .autocomplete").find(".hover");if(o.length){if(o.prev().length){for(var n=0;n<1||((p.metaKey||p.ctrlKey)&&n<5);n++){if(n>1){var o=$(".post > .autocomplete").find(".hover")}o.prev().addClass("hover").siblings().removeClass("hover");if($(".hover:first").position().top<0){$(".post > .autocomplete").scrollTop($(".post > .autocomplete").scrollTop()-$(".hover:first").height()-8)}}}else{o.removeClass("hover")}return false}if($(".post > .autocomplete").length){if($(".post > .autocomplete").data("entered")){return false}else{$(".post > .autocomplete").remove()}}}else{if(p.which==27){if($(".post > .autocomplete").length){$(".post > .autocomplete").remove()}else{$(".post > .controls > .cancel > input").click()}return false}}}}if(p.which==9||p.which==13){return false}});$(d.contents()[0].documentElement).keyup(function(s){if(s.which==17||s.which==91||s.which==27){return true}var r=$(".post > .controls > .submit");var u=r.find("input");var q=$(r).data("limit");var n=$(r).data("text");for(var p="";p.length<g_myPanel.DOMElementList[g_myPanel.groupSelectedID].shortened_url_length;p+="X"){}if(q>this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/ig,p).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,p).length){var o=q-this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,p).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,p).length+" left"}else{var o=this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,p).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,p).length-q+" over"}$(u).val(n.replace("%edit.count_relative%",o));if(g_myPanel.accountList[0].medium=="TWITTER"){if(l_matches=this.innerHTML.stripHeadBody().stripHtml().match(/(^|[^a-zA-Z0-9])(@[a-zA-Z_]+)$/)){if(s.which==9||s.which==13||s.which==38||s.which==39||s.which==40){return false}$(".post > .autocomplete").remove();var t=$("<div></div>").addClass("autocomplete").width($(".post").width()).data("typed",l_matches[2]).hide();t.appendTo($(".post"));for(l_contact in g_myPanel.contacts){if(l_contact.toLowerCase().indexOf(l_matches[2].toLowerCase().substr(1))==0){$("<div></div>").addClass("entry").html(l_contact).appendTo(t)}}if(t.children().length){t.children().sortElements(function(w,v){return $(w).text().toLowerCase()<$(v).text().toLowerCase()?-1:1}).end().show()}}else{$(".post > .autocomplete").remove()}}});$(d.contents()[0].documentElement).click(function(){if(!g_editing){$(d.contents()[0].documentElement).focus()}});$(d.contents()[0].documentElement).focus(function(){g_editing=true;g_pastetarget=0;$("#post").find(".richtext:first")[0].contentWindow.document.designMode="on";$($("#post").find(".richtext:first").contents()[0].documentElement).css("font-size","14px").css("font-family","Helvetica").css("color","#000000").css("overflow-x"," none").css("word-break","break-word").css("padding-right","5px");$("#post").find(".richtext:first").addClass("focus expanded");$("#post").find(".richtext:first").parent().addClass("expanded");$(".post > .controls").show();if(this.innerHTML.indexOf($("#post").find(".richtext:first").data("helper"))!=-1){$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("selectall");$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("delete")}resize();return false});d[0].contentWindow.addEventListener("blur",function(){g_editing=false;$(this).removeClass("focus");setTimeout(function(){$(".post > .autocomplete").remove()},500)})}this.update()},scheduleUpdate:function(b){clearTimeout(this.updateScheduled);this.updateScheduled=setTimeout(function(){g_myPanel.update()},(b?b:250))},trashItem:function(c){var b=this.itemList[c].id;if(this.contacts[this.itemList[c].name]){if(this.contacts[this.itemList[c].name]==1){delete this.contacts[this.itemList[c].name]}else{this.contacts[this.itemList[c].name]--}}this.DOMElementList[this.itemList[c].DOMElementID]=null;delete this.DOMElementList[this.itemList[c].DOMElementID];this.itemList[c]=null;delete this.itemList[c];newsItemDestroy(b)}};function newsAccount(){}newsAccount.prototype={constructor:newsAccount,account:"",display_name:"",medium:"",stats:"",avatar_url:"",DOMElementID:-1,dirty:false,getHTML:function(){var b=$("<img></img>").addClass("account-avatar").attr("src",this.avatar_url);var d=$("<div></div>").addClass("account-display-name").html(this.display_name);var e=$("<div></div>").addClass("account-status").html(this.stats);var c=$("<div></div>").addClass("account-identity-panel").append(b).append(d).append(e);return $("<div></div>").addClass("account").attr("account",this.account).attr("id",this.DOMElementID).append(c)}};function newsGroup(){}newsGroup.prototype={constructor:newsGroup,header:"",name:"",display_name:"",dfault:"",empty_string:"",post_on:0,unread:0,post_button:"Submit (%edit.count_relative%)",post_helper:"Share something ...",post_limit:999,view:null,hasmap:false,stats:null,DOMElementID:-1,shortened_url_length:23,images_allowed:null,dirty:false,icon:null,getHTML:function(){var f=$("<li></li>").addClass("group hasmenu");var c=$("<div></div>").addClass("icon");var e=$("<div></div>").addClass("label");var d=$("<div></div>").addClass("unread");var b=$("<div></div>").addClass("count");f.attr("group",this.name);f.attr("id",this.DOMElementID);if(this.icon){c.addClass(this.icon)}else{c.addClass("feed")}c.appendTo(f);e.html(this.display_name);e.attr("text",this.display_name);e.appendTo(f);d.hide();b.text("0");b.appendTo(d);d.appendTo(f);return f},getPostHTML:function(){if(this.post_on){var h=$("<div></div>").addClass("post");var l=$("<div></div>").addClass("entry");var m=$("<div></div>").addClass("icon");var b=$("<div></div>").addClass("edit");var d=$("<iframe></iframe>").addClass("richtext");var e=$("<div></div>").addClass("controls");var c=$("<div></div>").addClass("picture");var f=$("<input></input>");var k=$("<div></div>").addClass("cancel");var g=$("<input></input>");var j=$("<div></div>").addClass("submit");var i=$("<input></input>");h.data("id",this.DOMElementID);m.text("+");d.data("id",this.DOMElementID);d.attr("id","iframe_post");d.attr("designMode",true);d.data("helper",this.post_helper);g.data("id",this.DOMElementID);f.data("id",this.DOMElementID);i.data("id",this.DOMElementID);j.data("limit",this.post_limit);j.data("text",this.post_button);$(h,d,g,i).data("item",this.id);e.hide();f.attr("type","button");f.val("Insert Picture");g.attr("type","button");g.val("Cancel");i.attr("type","button");i.val(this.post_button.replace("%edit.count_relative%",this.post_limit+" left"));m.appendTo(l);d.appendTo(b);b.appendTo(l);l.appendTo(h);i.appendTo(j);j.appendTo(e);g.appendTo(k);k.appendTo(e);f.appendTo(c);if(this.images_allowed){c.appendTo(e)}e.appendTo(h);return h}else{return $("<div></div>")}}};function newsItem(){}newsItem.prototype={constructor:newsItem,id:-1,parent_id:0,type:0,name:null,display_name:null,item:null,groups:[],unread:null,hide:false,avatar_url:null,timestamp:0,comments_on:0,comment_button:"Reply (%edit.count_relative%)",comment_helper:"",comment_limit:999,link_url:null,link_title:null,link_site:null,link_description:null,latitude:null,longitude:null,person:null,image_url:null,DOMElementID:-1,initial_text:null,images_allowed:null,getItemHTML:function(){var f=$("<div></div>").addClass("item hasmenu");var i=$("<div></div>").addClass("container");var e=$("<div></div>").addClass("avatar");var c=$("<img></img>");var h=$("<div></div>").addClass("message");var d=$("<div></div>").addClass("name");var g=$("<div></div>").addClass("time");var b=$("<div></div>").addClass("text");f.attr("id",this.DOMElementID);f.attr("item",this.id);f.attr("timestamp",this.timestamp);f.attr("parent_id",this.parent_id);c.attr("src",this.avatar_url);d.html(this.display_name);if(this.timestamp>31337){g.html(relativeTime(this.timestamp,new Date().getTime()))}else{g.html("")}if(this.item){b.html((this.display_name.length>20?"<br/>":"")+this.item)}else{b.html((this.display_name.length>20?"<br/>":"")+"&nbsp;")}c.appendTo(e);e.appendTo(i);g.appendTo(h);d.appendTo(h);b.appendTo(h);h.appendTo(i);i.appendTo(f);if(this.link_url){this.getLinkHTML().appendTo(h).show()}else{if(this.image_url){this.getImage().appendTo(h).show()}}return f},getLinkHTML:function(){var d=$("<div></div>").addClass("link");var c=$("<div></div>").addClass("content");var f=$("<a></a>").addClass("title");var b=$("<div></div>").addClass("site");var e=$("<div></div>").addClass("description");f.attr("href",this.link_url);f.attr("target","_new");if(this.link_title){f.html(this.link_title)}else{f.html(this.link_site);b.hide()}if(this.link_site.indexOf("apps.facebook.com")!=-1){b.hide()}b.html(this.link_site);if(this.link_description){e.html(this.link_description)}else{e.hide()}if(this.image_url){this.getLinkImage().appendTo(d)}f.appendTo(c);b.appendTo(c);e.appendTo(c);c.appendTo(d);return d},getLinkImage:function(){var e=$("<div></div>").addClass("image");var c=$("<div></div>").addClass("border");var d=$("<div></div>").addClass("fill");var b=$("<img></img>");b.attr("src",this.image_url);b.appendTo(d);d.appendTo(c);c.appendTo(e);b.load(function(){var f=$(this).height();$(this).parent().height(f);$(this).parent().width($(this).width());resize()});return e},getImage:function(){var e=$("<div></div>").addClass("image");var c=$("<div></div>").addClass("border");var d=$("<div></div>").addClass("fill");var b=$("<img></img>");b.attr("src",this.image_url);b.appendTo(d);d.appendTo(c);c.appendTo(e);b.load(function(){$(this).parent().parent().parent().css("opacity",1);var f=$(this).height();$(this).parent().height(f);$(this).parent().width($(this).width());resize()});return e},getSubitemsHTML:function(){var d=$("<div></div>").addClass("subitems");var h=$("<div></div>").addClass("envelope");var b=$("<div></div>").addClass("contents");var f=$("<div></div>").addClass("arrow");var c=$("<div></div>").addClass("border");var e=$("<div></div>").addClass("fill");var g=$("<div></div>").addClass("comments");d.hide();f.appendTo(d);c.appendTo(f);e.appendTo(c);g.appendTo(b);if(this.comments_on){this.getReplyHTML().appendTo(b);d.show()}b.appendTo(h);h.appendTo(d);return d},getCommentHTML:function(){var g=$("<div></div>").addClass("subitem hasmenu");var d=$("<div></div>").addClass("comment");var b=$("<div></div>").addClass("content");var e=$("<div></div>").addClass("avatar");var j=$("<img></img>");var f=$("<div></div>").addClass("name");var i=$("<div></div>").addClass("text");var h=$("<div></div>").addClass("time");var c=$("<div></div>").addClass("text");g.attr("id",this.DOMElementID);g.attr("item",this.id);g.attr("parent_id",this.parent_id);g.attr("timestamp",this.timestamp);j.attr("src",this.avatar_url);if(!this.avatar_url){e.css("opacity",0.01)}i.html(this.display_name);if(this.timestamp>31337){h.html(relativeTime(this.timestamp,new Date().getTime()))}else{h.html("")}if(c.length){c.html(this.item)}else{c.html("&nbsp;")}j.appendTo(e);e.appendTo(d);i.appendTo(f);f.appendTo(b);h.appendTo(b);c.appendTo(b);b.appendTo(d);d.appendTo(g);return g},getReplyHTML:function(){var g=$("<div></div>").addClass("reply");var c=$("<div></div>").addClass("entry");var i=$("<div></div>").addClass("edit");if(g_myPanel.accountList[0].medium=="TWITTER"){var b=$("<iframe></iframe>").addClass("richtext")}else{var b=$("<textarea></textarea>")}var h=$("<div></div>").addClass("controls");var e=$("<div></div>").addClass("picture");var l=$("<input></input>");var k=$("<div></div>").addClass("cancel");var d=$("<input></input>");var f=$("<div></div>").addClass("submit");var j=$("<input></input>");g.data("id",this.DOMElementID);b.data("id",this.DOMElementID);b.attr("designMode","on");d.data("id",this.DOMElementID);j.data("id",this.DOMElementID);$(g,b,d,j).data("item",this.id);h.hide();l.attr("type","button");l.val("Insert Picture");l.data("full-label","Insert Picture");l.data("smaller-label","Picture");f.data("limit",this.comment_limit);f.data("text",this.comment_button);d.attr("type","button");d.val("Cancel");j.attr("type","button");b.data("helper",this.comment_helper);b.data("initial",this.initial_text);if(g_myPanel.accountList[0].medium!="TWITTER"){b.val(this.comment_helper)}b.appendTo(i);i.appendTo(c);c.appendTo(g);j.appendTo(f);f.appendTo(h);d.appendTo(k);k.appendTo(h);l.appendTo(e);if(this.images_allowed){e.appendTo(h)}h.appendTo(g);return g}};function newsFocused(){var b=g_myPanel.DOMElementList[g_myPanel.groupSelectedID];if(!b){return}newsGroupViewed(g_myPanel.DOMElementList[g_myPanel.groupSelectedID].name);if(b.unread>0){b.unread=0;unread()}else{b.unread=0}setTimeout(function(){$("#"+b.DOMElementID).find(".count").text(0).parent().hide().parent().find(".label").removeClass("limited")},1000)}function newsAccountAdd(e,c,d,b,f){var g=new newsAccount();g.account=e;g.display_name=decodeURIComponent(c);g.medium=d;g.stats=decodeURIComponent(b);g.avatar_url=f;g_myPanel.addAccount(g)}function newsAccountUpdate(c,b){}function newsAccountRemove(b){g_myPanel.removeAccount(b)}function newsGroupAdd(j,i,l,n,h,k,b,o,m,g,f,e,c){var d=new newsGroup();if(j==null){d.header=getMediumDisplayName()}else{d.header=decodeURIComponent(j)}d.name=decodeURIComponent(i);d.display_name=decodeURIComponent(l);d.dfault=n;d.empty_string=decodeURIComponent(h);d.post_on=k;if(b){d.post_button=b}d.post_helper=o;d.post_limit=m;d.stats=g;if(f){d.shortened_url_length=f}g_myPanel.addGroup(d);if(e!=null){d.images_allowed=e}if(c!=null){d.icon=c}}function getMediumDisplayName(){switch(g_myPanel.accountList[0].medium){case"TWITTER":return"Twitter";case"FACEBOOK":return"Facebook";case"FOURSQUARE":return"Foursquare";case"LINKEDIN":return"LinkedIn";default:return g_myPanel.accountList[0].medium}}function newsGroupUpdate(f,e,h,j,d,g,b,k,i,c){if(c!=null){for(var l in g_myPanel.groupList){if(g_myPanel.groupList[l].name==e){g_myPanel.groupList[l].stats=c;g_myPanel.scheduleUpdate()}}}}function newsGroupRemove(f,e,h,j,d,g,b,k,i,c){g_myPanel.removeGroup(f,e)}function newsItemAdd(m,b,p,i,k,g,q,s,v,z,c,n,e,f,u,w,h,y,x,o,t,j){if(v){return}var r=new newsItem();r.id=m;r.parent_id=b;r.type=p;r.name=i;if(k){r.display_name=decodeURIComponent(k)}else{r.display_name=i}r.item=g;r.item=replaceURLWithHTMLLinks(g);var l=q.split(";");for(var d in l){l[d]=decodeURIComponent(l[d])}r.groups=l;r.unread=s;r.hide=v;r.avatar_url=z;r.timestamp=c*1000;r.comments_on=n;if(e){r.comment_button=e}r.comment_helper=f;if(u){r.comment_limit=u}r.link_url=w;r.link_title=h;if(!g&&h){r.item=h}r.link_site=replaceURLWithDomain(w);r.link_description=y;r.longitude=o;r.latitude=x;r.person=t;if(j!=null){r.images_allowed=j}g_myPanel.addItem(r)}function newsItemUpdate(l,b,o,i,j,g,p,r,u,z,c,m,e,f,t,v,h,y,w,n,s){for(var x in g_myPanel.itemList){if(g_myPanel.itemList[x].id==l){var q=g_myPanel.itemList[x];break}}if(!q){return false}if(b){q.parent_id=b}if(o){q.type=o}if(i){q.name=i}if(j){q.display_name=decodeURIComponent(j)}else{if(i){q.display_name=i}}if(g){q.item=replaceURLWithHTMLLinks(g)}if(p.length){var k=p.split(";");for(var d in k){k[d]=decodeURIComponent(k[d])}q.groups=k}if(r){q.unread=r}if(u){q.hide=u}if(z){q.avatar_url=z}if(c){q.timestamp=c*1000}if(m){q.comments_on=m}if(e){q.comment_button=e}if(f){q.comment_helper=f}if(t){q.comment_limit=t}if(v){q.link_url=v}if(h){q.link_title=h}if(v){q.link_site=replaceURLWithDomain(v)}if(y){q.link_description=y}g_myPanel.setDirty(q);g_myPanel.scheduleUpdate();return true}function newsItemChildrenClear(b){for(var c in g_myPanel.itemList){if(g_myPanel.itemList[c].parent_id==b){g_myPanel.itemList.splice(c,1)}}for(var c in g_myPanel.itemList){if(g_myPanel.itemList[c].id==b){g_myPanel.setDirty(g_myPanel.itemList[c])}}g_myPanel.scheduleUpdate();return true}function newsItemRemove(d){for(var c in g_myPanel.itemList){if(g_myPanel.itemList[c].id==d){var b=g_myPanel.itemList[c].id;if(g_myPanel.contacts[g_myPanel.itemList[c].name]){if(g_myPanel.contacts[g_myPanel.itemList[c].name]==1){delete g_myPanel.contacts[g_myPanel.itemList[c].name]}else{g_myPanel.contacts[g_myPanel.itemList[c].name]--}}g_myPanel.DOMElementList[g_myPanel.itemList[c].DOMElementID]=null;delete g_myPanel.DOMElementList[g_myPanel.itemList[c].DOMElementID];g_myPanel.itemList[c]=null;delete g_myPanel.itemList[c];newsItemDestroy(b);break}}$("div.item[item="+d+"]").remove();return true}function newsItemImageAdd(c,b){g_myPanel.addImage(c,b)}function newsItemImageClear(c,b){g_myPanel.addImage(c,null)}function newsItemCommentFocus(g,l,e,b,m,h){var j=$("div.item[item="+g+"], div.subitem[item="+g+"]").first();if(l!=null){g_myPanel.DOMElementList[j.attr("id")].comment_limit=l}if(e!=null){g_myPanel.DOMElementList[j.attr("id")].comment_button=e}if(b!=null){g_myPanel.DOMElementList[j.attr("id")].comment_helper=b}if(m!=null){g_myPanel.DOMElementList[j.attr("id")].initial_text=m}if(h!=null){g_myPanel.DOMElementList[j.attr("id")].images_allowed=h}var i=parseInt(j.attr("parent_id"));if(i>0&&i!="NaN"){j=$("div.item[item="+i+"]")}if(j.length){var c=j.find("div.subitems:first");if(!c.length){c=g_myPanel.DOMElementList[j.attr("id")].getSubitemsHTML();c.appendTo(j)}var k=c.find("div.reply");if(k.length){var d=k.find(".controls");k.show();d.show();if(g_myPanel.accountList[0].medium=="TWITTER"){k.richReply();k.find(".richtext:first").contents()[0].documentElement.focus();setTimeout(function(){k.find(".richtext:first").contents()[0].documentElement.focus()},2000);d=null}else{k.find(".entry > .edit > textarea").focus()}}else{if(c.find("div.envelope > div.contents > div.comments").children().length){var f=$("<div></div>").addClass("separator");f.appendTo(c.find("div.comments"))}var k=g_myPanel.DOMElementList[j.attr("id")].getReplyHTML();k.appendTo(c.find(".contents:first"));c.show();var k=c.find(".reply");if(k.length){if(g_myPanel.accountList[0].medium=="TWITTER"){k.richReply();k.find(".richtext:first").contents()[0].documentElement.focus();setTimeout(function(){k.find(".richtext:first").contents()[0].documentElement.focus()},2000)}else{k.find(".entry > .edit > textarea").focus()}}}}}function newsItemReply(b){newsItemCommentFocus(b,null,null,null,null,null);return}function newsMenuAdd(b){$("#menu").children().remove();$("#menu").data("item",b.id);$("#menu").css({top:b.Y,left:b.X}).show();for(l_enum=0;l_enum<b.choices.length;l_enum++){switch(b.choices[l_enum].type){case"text":var c=$("<div></div>").html(b.choices[l_enum].label).addClass("choice").attr("choice",b.choices[l_enum].id);$("#menu").append(c);break;case"separator":var c=$("<div></div>").addClass("separator");$("#menu").append(c);break}}}var g_months=["January","February","March","April","May","June","July","August","September","October","November","December"];function relativeTime(e,c){var d=c/1000-e/1000;if(d>86400){var b=new Date(e);return g_months[b.getMonth()]+" "+b.getDate()}if(d>3600){return parseInt(d/3600)+"h"}if(d>60){return parseInt(d/60)+"m"}return"<1m"}function tick(){g_myPanel.tock()}setInterval(tick,15000);var g_editing=false;var g_replying=false;var g_pastetarget=0;var g_myPanel=new newsPanel();$(document).ready(function(){if(($.browser.webkit||$.browser.safari)&&$.browser.version<"533"){$("#groups > .header > li.group").addClass("compatible")}$("#groups > .header > li.group").live("click",function(){g_myPanel.groupSelectedID=$(this).attr("id");viewed();g_myPanel.update(true)});$(".subitem.hasmenu, .item.hasmenu").live("contextmenu",function(e){var l_Y=e.pageY;var l_X=e.pageX;newsItemMenu($(this).attr("item"),l_X,l_Y);return false});$("#groups > .header > li.group.hasmenu").live("contextmenu",function(e){var l_Y=e.pageY;var l_X=e.pageX;newsGroupMenu(unescape($(this).attr("group")),l_X,l_Y);return false});$(".account.hasmenu").live("contextmenu",function(e){var l_Y=e.pageY;var l_X=e.pageX;newsAccountMenu(l_X,l_Y);return false});$("#menu > .choice").live("mouseenter",function(e){$(this).addClass("hovered")});$("#menu > .choice").live("mouseleave",function(e){$(this).removeClass("hovered")});$("#menu").live("contextmenu",function(e){$("#menu").hide();return false});$("#menu > .choice").live("contextmenu",function(e){$(this).click()});$("#menu > .choice").live("click",function(e){var l_itemnum=$("#menu").data("item");var l_choicenum=$(this).attr("choice");var l_itemtext=$(this).html();$("#menu").hide();switch(l_itemtext){case"Reply...":newsItemReply(l_itemnum);break}});$(".item").live("dblclick",function(){if(!$(this).find(".reply > .entry > .edit > richtext.focus").length){$(this).addClass("selected");var l_id=$(this).attr("item");newsItemDefaultAction(l_id);return false}});$(".item > .container > .message > .link > .content > .title").live("click",function(){trillian.openURL($(this).attr("href"))});$(".item:not(.subitem)").live("click",function(){if($(this).hasClass("selected")){$(this).removeClass("selected")}else{$(".item, .subitem").removeClass("selected");if(!$(this).find(".reply > .entry > .edit > .richtext.focus").length){$(this).addClass("selected");g_replying=false;$("#items").find(".richtext").removeClass("focus")}}if(g_myPanel.DOMElementList[$(this).attr("id")].longitude){window.frames.map.showPoint(g_myPanel.DOMElementList[$(this).attr("id")].latitude,g_myPanel.DOMElementList[$(this).attr("id")].longitude)}});$(".post > .controls > .submit > input").live("click",function(){$(".post > .autocomplete").remove();var l_name=g_myPanel.DOMElementList[g_myPanel.groupSelectedID].name;var l_post=$("#post").find(".richtext:first").contents()[0].documentElement.innerHTML;if(l_post!=""){var l_num=1;if(l_post.indexOf("javascript:")===0){return setTimeout(function(){trillian.log(eval(l_post.substr(11)))},1000)}l_post=l_post.stripHeadBody();if(l_post.indexOf('<img src="data:image/png;base64,')!=-1){var l_matches=[];while(l_post.indexOf('<img src="data:image/png;base64,')!=-1&&l_num<50){l_matches=l_post.match(/(.*)(\<img src="data:image\/png;base64,([a-zA-Z0-9+\/]+={0,2})"[^>]*\>)(.*)/i);if(!l_matches){break}l_post=l_post.replace(/(.*)(\<img src="data:image\/png;base64,([a-zA-Z0-9+\/]+={0,2})"[^>]*\>)(.*)/i,'$1<IMG ID="'+l_num+'" SRC="image'+l_num+'.jpg">$4<DATA ID="'+l_num+'" TYPE="base64">$3</DATA>');l_num++;if(l_num==50){trillian.log("matchfail")}}l_post="<HTML>"+l_post.substr(0,l_post.indexOf("<DATA"))+"</HTML><BINARY>"+l_post.substr(l_post.indexOf("<DATA"))+"</BINARY>";l_post=l_post.stripTags()}else{l_post=l_post.stripHtml().htmlentities()}if(l_post.length){newsPost(l_name,l_post)}}$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("selectall");$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("delete");$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("inserttext",false,$(".post > .entry > .edit > .richtext:first").data("helper"));$($("#post").find(".richtext:first").contents()[0].documentElement).css("font-size","14px").css("font-family","Helvetica").css("color","#acacac");$(".post > .entry > .edit > .richtext:first").removeClass("expanded");$(".post > .entry > .edit").removeClass("expanded");$(".post > .controls").hide();resize();return false});$(".post > .controls > .cancel > input").live("click",function(){$(".post > .autocomplete").remove();$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("selectall");$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("delete");$($("#post").find(".richtext:first").contents()[0].documentElement).css("font-size","14px").css("font-family","Helvetica").css("color","#acacac");$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("inserttext",false,$(".post > .entry > .edit > .richtext:first").data("helper"));$(".post > .entry > .edit > .richtext:first").removeClass("expanded");$(".post > .entry > .edit").removeClass("expanded");$(".post > .controls").hide();$($("#post").find(".richtext:first").contents()[0].documentElement).blur();resize();return true});$(".post > .controls > .picture > input").live("click",function(){newsGetImageFromFile()});$(".reply > .entry > .edit > textarea").live("keyup",function(){var l_item=$(this).parent().parent().parent().parent().parent().parent().parent();var l_submit=l_item.find(".reply > .controls > .submit input");if(g_myPanel.DOMElementList[l_item.attr("id")].comment_limit>$(this).val().length){var l_counter=g_myPanel.DOMElementList[l_item.attr("id")].comment_limit-$(this).val().length+" left"}else{var l_counter=$(this).val().length-g_myPanel.DOMElementList[l_item.attr("id")].comment_limit+" over"}l_submit.val(g_myPanel.DOMElementList[l_item.attr("id")].comment_button.replace("%edit.count_relative%",l_counter))});$(".reply > .entry > .edit > textarea").live("focus",function(){$(this).addClass("focus");this.setSelectionRange($(this).val().length*2);var l_item=$(this).parent().parent().parent().parent().parent().parent().parent();l_item.find(".reply > .controls").show();if($(this).val()==g_myPanel.DOMElementList[l_item.attr("id")].comment_helper){$(this).val((g_myPanel.DOMElementList[l_item.attr("id")].initial_text?g_myPanel.DOMElementList[l_item.attr("id")].initial_text:""))}var l_submit=l_item.find(".reply > .controls > .submit input");if(g_myPanel.DOMElementList[l_item.attr("id")].comment_limit>$(this).val().length){var l_counter=g_myPanel.DOMElementList[l_item.attr("id")].comment_limit-$(this).val().length+" left"}else{var l_counter=$(this).val().length-g_myPanel.DOMElementList[l_item.attr("id")].comment_limit+" over"}l_submit.val(g_myPanel.DOMElementList[l_item.attr("id")].comment_button.replace("%edit.count_relative%",l_counter));resize();return true});$(".reply > .controls > .picture > input").live("click",function(){newsGetImageFromFile()});$(".reply > .controls > .cancel > input").live("click",function(){if(g_myPanel.accountList[0].medium=="TWITTER"){var l_item=$(this).parent().parent().parent().parent().parent().parent().parent();if(g_myPanel.DOMElementList[$(this).data("id")].comments_on){l_item.find(".reply > .controls").hide();l_item.find(".richtext:first")[0].contentWindow.document.execCommand("");l_item.find(".richtext:first").contents()[0].documentElement.innerHTML=l_item.find(".richtext:first").height(18).data("helper");$(l_item.find(".richtext:first").contents()[0].documentElement).css("color","acacac").css("font-style","italic").css("font-size","12px");if($.browser.version>"534.48."){$(l_item.find(".richtext:first").contents()[0].documentElement).css("margin-top","-7px")}$(l_item.find(".richtext:first").contents()[0].documentElement).blur()}else{l_item.find(".reply").remove();l_item.find(".comments > .separator:last").remove();if(l_item.find(".comments").children().length==0){l_item.find(".subitems").hide()}}}else{var l_item=$(this).parent().parent().parent().parent().parent().parent().parent();if(g_myPanel.DOMElementList[$(this).data("id")].comments_on){l_item.find(".reply > .controls").hide();l_item.find(".reply > .entry > .edit > textarea").val(g_myPanel.DOMElementList[l_item.attr("id")].comment_helper).removeClass("focus")}else{l_item.find(".reply").remove();l_item.find(".comments > .separator:last").remove();if(l_item.find(".comments").children().length==0){l_item.find(".subitems").hide()}}}g_replying=false;resize();return false});$(".reply > .controls > .submit > input").live("click",function(){var l_id=g_pastetarget;if(l_id){$(".subitems > .autocomplete").remove();var l_item=$("div.item[item="+l_id+"]");var l_richtext=l_item.find(".richtext:first");var l_name=g_myPanel.DOMElementList[l_item.attr("id")].name;var l_post=l_richtext.contents()[0].documentElement.innerHTML;if(l_post!=""){var l_num=1;l_post=l_post.stripHeadBody();if(l_post.indexOf('<img src="data:image/png;base64,')!=-1){var l_matches=[];while(l_post.indexOf('<img src="data:image/png;base64,')!=-1&&l_num<50){l_matches=l_post.match(/(.*)(\<img src="data:image\/png;base64,([a-zA-Z0-9+\/]+={0,2})"[^>]*\>)(.*)/i);if(!l_matches.length){break}l_post=l_post.replace(/(.*)(\<img src="data:image\/png;base64,([a-zA-Z0-9+\/]+={0,2})"[^>]*\>)(.*)/i,'$1<IMG ID="'+l_num+'" SRC="image'+l_num+'.jpg">$4<DATA ID="'+l_num+'" TYPE="base64">$3</DATA>');l_num++;if(l_num==50){trillian.log("matchfail")}}l_post="<HTML>"+l_post.substr(0,l_post.indexOf("<DATA"))+"</HTML><BINARY>"+l_post.substr(l_post.indexOf("<DATA"))+"</BINARY>";l_post=l_post.stripTags()}else{l_post=l_post.stripHtml().htmlentities()}if(l_post.length){newsComment(l_id,l_post,l_name)}}l_richtext.contents()[0].documentElement.innerHTML=l_richtext.height(18).data("helper");$(l_richtext.contents()[0].documentElement).css("color","acacac").css("font-style","italic").css("font-size","12px")}else{var l_item=$(this).parent().parent().parent().parent().parent().parent().parent();var l_id=l_item.attr("item");var l_name=g_myPanel.DOMElementList[l_item.attr("id")].name;var l_post=l_item.find(".reply > .entry > .edit > textarea").val();if(l_post!=""&&l_post!=g_myPanel.DOMElementList[l_item.attr("id")].initial_text+" "){newsComment(l_id,l_post,l_name)}}if(g_myPanel.DOMElementList[l_item.attr("id")].comments_on){l_item.find(".reply > .controls").hide();l_item.find(".reply > .entry > .edit > .richtext").removeClass("focus");l_item.find(".reply > .entry > .edit > textarea").val(g_myPanel.DOMElementList[l_item.attr("id")].comment_helper).removeClass("focus")}else{l_item.find(".reply").remove();l_item.find(".comments > .separator:last").remove();if(l_item.find(".comments").children().length==0){l_item.find(".subitems").hide()}}g_replying=false;resize();return false});$(".post > .controls").find("input").live("mouseenter",function(){$(".post > .entry > .edit > .richtext:first").css("outline","none")});$(".post > .controls").find("input").live("mouseleave",function(){$(".post > .entry > .edit > .richtext:first").css("outline","")});$(".reply > .controls").find("input").live("mouseenter",function(){});$(".reply > .controls").find("input").live("mouseleave",function(){});$(".post > .autocomplete > .entry").live("mouseenter",function(){$(this).addClass("hover").siblings().removeClass("hover")});$(".post > .autocomplete > .entry").live("mouseleave",function(){$(this).removeClass("hover")});$(".post > .autocomplete > .entry").live("click",function(){$("#post").find(".richtext:first")[0].contentWindow.document.execCommand("inserttext",false,$(this).text().substr($(this).parent().data("typed").length-1)+" ");$(".post > .autocomplete").remove();$("#post").find(".richtext:first").focus()});$(".subitems > .autocomplete > .entry").live("mouseenter",function(){$(this).addClass("hover").siblings().removeClass("hover")});$(".subitems > .autocomplete > .entry").live("mouseleave",function(){$(this).removeClass("hover")});$(".subitems > .autocomplete > .entry").live("click",function(){$("div.item[item="+g_pastetarget+"]").find(".richtext:first")[0].contentWindow.document.execCommand("inserttext",false,$(this).text().substr($(this).parent().data("typed").length-1)+" ");$(".subitems > .autocomplete").remove();$("div.item[item="+g_pastetarget+"]").find(".richtext:first").focus()});$(".item").find(".fill > img").live("click dblclick",function(){newsImageDefaultAction($(this).attr("src"),$(this).parent().parent().parent().parent().parent().parent().attr("item"));return false});$(".item > .container > .message > .name").live("click",function(){newsItemDefaultAction($(this).parent().parent().parent().attr("item"));return false});$(".comment > .content > .name > .text").live("click",function(){newsItemDefaultAction($(this).parent().parent().parent().parent().attr("item"));return false});$(".comment > .avatar").live("click",function(){newsItemDefaultAction($(this).parent().parent().attr("item"));return false});$("li.header > .showhide").live("mouseenter",function(){$(this).find(".label").show();$(this).parent().find(".label").addClass("shortened")});$("li.header > .showhide > .label").live("mouseenter",function(){$(this).addClass("over");$(this).parent().find(".label").removeClass("shortened");if($(this).hasClass("down")){$(this).addClass("highlighted")}});$("li.header > .showhide").live("mouseleave",function(){if(!$(this).find(".label").hasClass("down")){$(this).find(".label").hide()}$(this).parent().find(".label").removeClass("shortened")});$("li.header > .showhide > .label").live("mouseleave",function(){$(this).removeClass("over").removeClass("highlighted")});$("li.header > .showhide").live("mousedown",function(){$(this).find(".label").addClass("down");if($(this).find(".label").hasClass("over")){$(this).find(".label").addClass("highlighted")}return true});$("li.header > .showhide").live("dblclick",function(){if($(this).find(".label").text()=="Hide"){$(this).parent().find(".group").hide();$(this).find(".label").text("Show");resize()}else{$(this).parent().find(".group").show();$(this).find(".label").text("Hide");resize()}});$("li.header > .showhide").live("mouseup",function(){$(this).find(".label").removeClass("down").removeClass("highlighted");if($(this).find(".label").hasClass("over")){if($(this).find(".label").text()=="Hide"){$(this).parent().find(".group").hide();$(this).find(".label").text("Show");resize()}else{$(this).parent().find(".group").show();$(this).find(".label").text("Hide");resize()}}return false});$("*").live("mouseup",function(){if(!$(this).hasClass("showhide")){$("li.header > .showhide > .label").removeClass("down").hide()}});resize();$("#items").click(viewed);$("#items").scroll(viewed);$("#items").scroll(viewed);$("body").live("selectstart",function(){if(!g_editing&&!g_replying){return false}})});function resize(){var d=$(window).height();var b=$("#accounts").height();var g=$("#post").height();var f=d;var h=$("#view").height();var i=d-b-g-h;var j=d;var e=d;$("#items").height(i);$("#panel").height(f);$("#right").height(j);var c=$("#panel").width()-$("#left").width()-1;$("#items").width(c);$("#view").width(c);$(".post").width(c);$(".post > .controls").width(c);$("div.message").each(function(){if($(this).height()<52){$(this).css("margin-top",(($(this).height()/2)+35)*-1+"px").css("padding-bottom",(52-$(this).height())/4)}else{$(this).css("margin-top",-52)}});if(c<333){$(".reply > .controls > .picture > input").each(function(){$(this).val($(this).data("smaller-label"))})}else{$(".reply > .controls > .picture > input").each(function(){$(this).val($(this).data("full-label"))})}if($("#left").hasScrollBar()){$("#groups").addClass("scrollable")}else{$("#groups").removeClass("scrollable")}}function viewed(){var b=g_myPanel.DOMElementList[g_myPanel.groupSelectedID];if(!b){return}newsGroupViewed(g_myPanel.DOMElementList[g_myPanel.groupSelectedID].name);if(b.unread>0){b.unread=0;unread()}else{b.unread=0}$("#"+b.DOMElementID).find(".count").text(0).parent().hide().parent().find(".label").removeClass("limited")}function unread(){var b=0;for(l_enum in g_myPanel.groupList){if(g_myPanel.groupList[l_enum].unread>0&&g_myPanel.groupList[l_enum].unread!="NaN"){b+=g_myPanel.groupList[l_enum].unread}}newsAccountUnread(b)}$(window).bind("resize",resize);$(document).bind("click",function(){$("#menu").hide()});$(document).bind("contextmenu",function(){$("#menu").hide();return false});function replaceURLWithHTMLLinks(b){if(b){return b.replace(/(<a href=")?((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))(">([^<]+)<\/a>)?/ig,function(d,c,j,i,h,g,f,e){return e?'<a href="'+j+'" title="'+j+'+">'+e+"</a>":'<a href="'+j+'" title="'+j+'">'+j+"</a>"})}}function replaceURLWithDomain(c){if(c){var b=/(\b(https?|ftp|file):\/\/([-A-Z0-9+&@#%?='~_|!:,.;]*)([\/]?[-A-Z0-9+&@?#\/%=~_|]*))/ig;return c.replace(b,"$3")}}function replaceTwitterTagsWithLinks(c){if(c){var b=c.replace(/<a href="twitter_[a-zA-Z0-9_]:\/\/([a-zA-Z0-9_]+)">([^<]+)<\/a>/ig,'<a href="http://twitter.com/$1">$2</a>');return b.replace(/\B(#[a-zA-Z0-9_]+)/ig,"<a href='http://search.twitter.com/search?q=$1'>$1</a>")}}String.prototype.stripHtml=function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/\<br ?\/?\>/ig,"").replace(/\<\/?(div|span)\>/ig,"").replace(/\t/ig,"")};String.prototype.stripHeadBody=function(){return this.replace(/<head><\/head><body>(.*)<\/body>/,"$1")};String.prototype.stripTags=function(){return this.replace(/&nbsp;/g," ").replace(/\<br ?\/?\>/ig,"").replace(/\<\/?(div|span)\>/ig,"").replace(/\t/ig,"")};String.prototype.htmlentities=function(){return this.replace(/&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")};String.prototype.linkifyTwitter=function(){return this.replace(/([^\>])(@[a-zA-Z0-9_]+)([^a-zA-Z0-9])/,"$1<span style='color: blue'>$2</span>$3")};(function(c){c.tinysort={id:"TinySort",version:"1.0.4",defaults:{order:"asc",attr:"",place:"start",returns:false}};c.fn.extend({tinysort:function(j,k){if(j&&typeof(j)!="string"){k=j;j=null}var f=c.extend({},c.tinysort.defaults,k);var q={};this.each(function(u){var w=(!j||j=="")?c(this):c(this).find(j);var v=f.order=="rand"?""+Math.random():(f.attr==""?w.text():w.attr(f.attr));var t=c(this).parent();if(!q[t]){q[t]={s:[],n:[]}}if(w.length>0){q[t].s.push({s:v,e:c(this),n:u})}else{q[t].n.push({e:c(this),n:u})}});for(var h in q){var e=q[h];e.s.sort(function l(u,t){var i=u.s.toLowerCase?u.s.toLowerCase():u.s;var v=t.s.toLowerCase?t.s.toLowerCase():t.s;if(d(u.s)&&d(t.s)){i=parseFloat(u.s);v=parseFloat(t.s)}return(f.order=="asc"?1:-1)*(i<v?-1:(i>v?1:0))})}var n=[];for(var h in q){var e=q[h];var o=[];var g=c(this).length;switch(f.place){case"first":c.each(e.s,function(t,u){g=Math.min(g,u.n)});break;case"org":c.each(e.s,function(t,u){o.push(u.n)});break;case"end":g=e.n.length;break;default:g=0}var r=[0,0];for(var m=0;m<c(this).length;m++){var p=m>=g&&m<g+e.s.length;if(b(o,m)){p=true}var s=(p?e.s:e.n)[r[p?0:1]].e;s.parent().append(s);if(p||!f.returns){n.push(s.get(0))}r[p?0:1]++}}return this.pushStack(n)}});function d(f){var e=/^\s*?[\+-]?(\d*\.?\d*?)\s*?$/.exec(f);return e&&e.length>0?e[1]:false}function b(f,g){var e=false;c.each(f,function(j,h){if(!e){e=h==g}});return e}c.fn.TinySort=c.fn.Tinysort=c.fn.tsort=c.fn.tinysort})(jQuery);jQuery.fn.sortElements=(function(){var b=[].sort;return function(d,e){e=e||function(){return this};var c=this.map(function(){var g=e.call(this),f=g.parentNode,h=f.insertBefore(document.createTextNode(""),g.nextSibling);return function(){if(f===this){throw new Error("You can't sort elements if any one is a descendant of another.")}f.insertBefore(this,h);f.removeChild(h)}});return b.call(this,d).each(function(f){c[f].call(e.call(this))})}})();function buildMap(){$("#view").show();for(var c in g_myPanel.itemList){var b=g_myPanel.itemList[c];if(b.groups.indexOf(g_myPanel.DOMElementList[g_myPanel.groupSelectedID].name)!=-1){if(b.person){window.frames.map.addFriend(b.id,b.latitude,b.longitude,b.display_name,b.item,b.avatar_url)}else{window.frames.map.addVenueDot(b.id,b.latitude,b.longitude,b.display_name)}}}window.frames.map.showFriends();window.frames.map.refit(1);g_myPanel.DOMElementList[g_myPanel.groupSelectedID].view=window.frames.map}(function(d){var b=d.scrollTo=function(g,f,e){d(window).scrollTo(g,f,e)};b.defaults={axis:"xy",duration:parseFloat(d.fn.jquery)>=1.3?0:1};b.window=function(e){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var f=this,e=!f.nodeName||d.inArray(f.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!e){return f}var g=(f.contentWindow||f).document||f.ownerDocument||f;return d.browser.safari||g.compatMode=="BackCompat"?g.body:g.documentElement})};d.fn.scrollTo=function(g,f,e){if(typeof f=="object"){e=f;f=0}if(typeof e=="function"){e={onAfter:e}}if(g=="max"){g=9000000000}e=d.extend({},b.defaults,e);f=f||e.speed||e.duration;e.queue=e.queue&&e.axis.length>1;if(e.queue){f/=2}e.offset=c(e.offset);e.over=c(e.over);return this._scrollable().each(function(){var m=this,k=d(m),l=g,j,h={},n=k.is("html,body");switch(typeof l){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(l)){l=c(l);break}l=d(l,this);case"object":if(l.is||l.style){j=(l=d(l)).offset()}}d.each(e.axis.split(""),function(r,s){var t=s=="x"?"Left":"Top",v=t.toLowerCase(),q="scroll"+t,p=m[q],o=b.max(m,s);if(j){h[q]=j[v]+(n?0:p-k.offset()[v]);if(e.margin){h[q]-=parseInt(l.css("margin"+t))||0;h[q]-=parseInt(l.css("border"+t+"Width"))||0}h[q]+=e.offset[v]||0;if(e.over[v]){h[q]+=l[s=="x"?"width":"height"]()*e.over[v]}}else{var u=l[v];h[q]=u.slice&&u.slice(-1)=="%"?parseFloat(u)/100*o:u}if(/^\d+$/.test(h[q])){h[q]=h[q]<=0?0:Math.min(h[q],o)}if(!r&&e.queue){if(p!=h[q]){i(e.onAfterFirst)}delete h[q]}});i(e.onAfter);function i(o){k.animate(h,f,e.easing,o&&function(){o.call(this,g,e)})}}).end()};b.max=function(k,j){var i=j=="x"?"Width":"Height",f="scroll"+i;if(!d(k).is("html,body")){return k[f]-d(k)[i.toLowerCase()]()}var h="client"+i,g=k.ownerDocument.documentElement,e=k.ownerDocument.body;return Math.max(g[f],e[f])-Math.min(g[h],e[h])};function c(e){return typeof e=="object"?e:{top:e,left:e}}})(jQuery);(function(b){b.fn.richReply=function(c){return this.each(function(){var h=b(this);var f=h;var e=false;var g=g_myPanel.DOMElementList[f.parent().parent().parent().parent().attr("id")];f.find(".richtext:first")[0].contentWindow.document.designMode="on";var d=b(f.find(".richtext:first").contents()[0].documentElement);d.attr("spellcheck","false");d.css("margin","0px").css("padding","2px").css("font-size","12px").css("font-family","Lucida Grande, sans-serif").css("color","#989898").css("background-color","#ffffff").css("font-style","italic").css("overflow-y","hidden");if(f.find(".richtext:first").data("helper")){d.html(f.find(".richtext:first").data("helper"))}if(f.find(".richtext:first").data("restore")){e=true;d.html(f.find(".richtext:first").data("restore"));if(d.text()!=f.find(".richtext:first").data("helper")){d.css("font-size","12px").css("font-family","Helvetica").css("color","#000000").css("overflow-x"," none").css("word-break","break-word").css("padding-right","5px").css("font-style","normal").css("overflow-y","hidden")}}d.data("parent_id",g.id);d.click(function(){if(!g_replying){d.focus()}});d.focus(function(){if(g_replying){return}g_replying=true;g_pastetarget=b(this).data("parent_id");var k=b("div.item[item="+b(this).data("parent_id")+"]");var o=k.find(".richtext");b(this).css("font-size","12px").css("font-family","Helvetica").css("color","#000000").css("overflow-x"," none").css("word-break","break-word").css("padding-right","5px").css("font-style","normal").css("overflow-y","hidden");o.height(48);var i="";var l=g_myPanel.DOMElementList[k.attr("id")].comment_limit;for(var j="";j.length<g_myPanel.DOMElementList[g_myPanel.groupSelectedID].shortened_url_length;j+="X"){}var n=this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,j).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,j).length;if(l>n){i=l-n+" left"}else{i=n-l+" over"}if(this.innerHTML.stripHeadBody().stripHtml().indexOf(o.data("helper"))!=-1||!o.data("helper")){i=l-g_myPanel.DOMElementList[k.attr("id")].initial_text.length+" left";o[0].contentWindow.document.execCommand("selectall");o[0].contentWindow.document.execCommand("delete");o.contents()[0].documentElement.innerHTML="&nbsp;";setTimeout(function(){var s=b("div.item[item="+g_pastetarget+"]").find(".richtext:first");s[0].contentWindow.document.execCommand("selectall");s[0].contentWindow.document.execCommand("delete");if(s.data("initial")){s[0].contentWindow.document.execCommand("inserttext",false,s.data("initial"))}try{var r=s[0].contentWindow;var p=r.document.createRange();p.setStart(r.document.body,0);p.setEnd(r.document.body,0);r.document.body.focus();r.getselection().addrange(p)}catch(q){}},200)}o.addClass("focus expanded one");k.find(".controls").show().find(".submit input").val(g_myPanel.DOMElementList[k.attr("id")].comment_button.replace("%edit.count_relative%",i));if(!o.hasClass("animated")&&o.position().top+((g_myPanel.accountList[0].medium=="TWITTER")?300:k.find(".reply").height()-10)>b("#items").height()){var m=-75;if(b("#items").height()>400){var m=(b("#items").height()-(g_myPanel.accountList[0].medium=="TWITTER"?330:k.find(".reply").height()+10))*-1}b("#items").scrollTo("[item="+g_pastetarget+"] > .subitems > .envelope > .contents > .reply",800,{easing:"swing",offset:m});o.addClass("animated")}resize();return false});d[0].addEventListener("blur",function(){var j=b(this.ownerDocument.defaultView.frameElement);var k=b(j.contents()[0].documentElement);if(j.contents()[0].documentElement.innerHTML.indexOf(j.data("helper"))!=-1){}var i=b("div.item[item="+g_pastetarget+"]");var l=i.find(".richtext");l.removeClass("focus");g_replying=false;setTimeout(function(){b("div.item[item="+g_pastetarget+"]").find(".autocomplete").remove()},500)});f.find(".richtext:first")[0].contentWindow.document.onpaste=function(j){j.preventDefault();if(j.clipboardData.types){if(j.clipboardData.types.length){if(j.clipboardData.types[1]=="text/plain"||j.clipboardData.types[0]=="text/rtf"){var i=j.clipboardData.getData("text/plain")}}}if(i){i=decodeURIComponent(encodeURIComponent(i.stripHtml()).replace(/%0D%0A/g,"").replace(/%0D/g,""));b("div.item[item="+g_pastetarget+"]").find(".richtext:first")[0].contentWindow.document.execCommand("inserttext",false,i);b(b("div.item[item="+g_pastetarget+"]").find(".richtext:first").contents()[0].documentElement).keyup()}else{newsGetImageFromClipboard()}return false};d.keydown(function(n){var k=b("div.item[item="+b(this).data("parent_id")+"]");var o=k.find(".richtext");var j=k.find(".autocomplete");if(n.which==9||n.which==39||n.which==13||n.which==32){var m=j.find(".hover");if(m.length){m.click();return false}}if(n.which==9){if(j.length){}j.find(".entry:first").click();return false}else{if(n.which==40){var m=j.find(".hover");if(m.length){if(m.next().length){for(var l=0;l<1||((n.metaKey||n.ctrlKey)&&l<5);l++){if(l>1){var m=j.find(".hover")}m.next().addClass("hover").siblings().removeClass("hover");if(j.height()-b(".hover:first").position().top<m.height()){j.scrollTop(b(".hover:first").height()+8+j.scrollTop())}}}return false}else{if(j.length){j.data("entered","true").find(".entry:first").addClass("hover");return false}}}else{if(n.which==38){var m=j.find(".hover");if(m.length){if(m.prev().length){for(var l=0;l<1||((n.metaKey||n.ctrlKey)&&l<5);l++){if(l>1){var m=j.find(".hover")}m.prev().addClass("hover").siblings().removeClass("hover");if(b(".hover:first").position().top<0){j.scrollTop(j.scrollTop()-b(".hover:first").height()-8)}}}else{m.removeClass("hover")}return false}if(j.length){if(j.data("entered")){return false}else{j.remove()}}}else{if(n.which==27){if(j.length){j.remove()}else{k.find(".controls > .cancel > input").click()}return false}}}}if(n.which==9||n.which==13||n.altKey&&(n.which!=37&&n.which!=39)||((n.ctrlKey||n.metaKey)&&(n.which!=86&&n.which!=65&&n.which!=88&&n.which!=37&&n.which!=39&&n.which!=81))){return false}});d.keyup(function(i){if(i.which==17||i.which==91||i.which==27){return false}var o=b(".reply > .controls > .submit");var l=o.find("input");var r=b(o).data("limit");var n=b(o).data("text");for(var p="";p.length<g_myPanel.DOMElementList[g_myPanel.groupSelectedID].shortened_url_length;p+="X"){}if(r>this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/ig,p).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,p).length){var m=r-this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,p).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,p).length+" left"}else{var m=this.innerHTML.stripHeadBody().stripHtml().replace(/\<img[^>]+\>/g,p).replace(/((https?|ftp|file):\/\/([-A-Z0-9+&@#\/%?='~_|!:,.;]*)([-A-Z0-9+&@#\/%=~_|]))/ig,p).length-r+" over"}b(l).val(n.replace("%edit.count_relative%",m));if(g_myPanel.accountList[0].medium=="TWITTER"){var s=b("div.item[item="+b(this).data("parent_id")+"]");var k=s.find(".richtext");var j=s.find(".autocomplete");if(l_matches=this.innerHTML.stripHeadBody().stripHtml().match(/(^|[^a-zA-Z0-9])(@[a-zA-Z_]+)$/)){if(i.which==9||i.which==13||i.which==38||i.which==39||i.which==40){return false}j.remove();var q=b("<div></div>").addClass("autocomplete").width(s.find(".edit").width()).data("typed",l_matches[2]).hide();q.appendTo(s.find(".subitems"));for(l_contact in g_myPanel.contacts){if(l_contact.toLowerCase().indexOf(l_matches[2].toLowerCase().substr(1))==0){b("<div></div>").addClass("entry").html(l_contact).appendTo(q)}}if(q.children().length){q.children().sortElements(function(u,t){return b(u).text().toLowerCase()<b(t).text().toLowerCase()?-1:1}).end().show();q.css("margin-bottom",-1*q.height()+"px");setTimeout(function(){var t=b("div.item[item="+g_pastetarget+"]").find(".autocomplete");if(t.length){if(t.position().top+t.height()>b("#items").height()){b("#items").scrollTo("+="+(t.position().top+t.height()-b("#items").height())+"px",500,{easing:"swing"})}}},500)}}else{j.remove()}}});if(g_myPanel.accountList[0].medium=="TWITTER"&&!e){d.focus()}})}})(jQuery);(function(b){b.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.height()}})(jQuery);